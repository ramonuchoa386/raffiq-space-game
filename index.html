<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>üöÄ Aventura Espacial do Raffiq</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.55.2/phaser.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(180deg, #000428 0%, #004e92 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
            overflow: hidden;
        }
        .container {
            text-align: center;
            width: 100%;
            max-width: 820px;
        }
        h1 {
            color: #00FFFF;
            font-size: 2rem;
            margin-bottom: 8px;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }
        .instructions {
            color: white;
            font-size: 1rem;
            margin-bottom: 5px;
        }
        .tip {
            color: #FFD700;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }
        #game-container {
            border: 4px solid #00FFFF;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
            display: inline-block;
            position: relative;
        }
        
        /* Controles mobile */
        #mobile-controls {
            display: none;
            position: fixed;
            bottom: 20px;
            left: 0;
            right: 0;
            width: 100%;
            height: 200px;
            pointer-events: none;
        }
        
        .dpad-container {
            position: absolute;
            left: 50%;
            bottom: 0;
            transform: translateX(-50%);
            width: 180px;
            height: 180px;
            pointer-events: all;
        }
        
        .dpad-button {
            position: absolute;
            width: 60px;
            height: 60px;
            background: rgba(0, 255, 255, 0.3);
            border: 3px solid #00FFFF;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #00FFFF;
            cursor: pointer;
            transition: all 0.1s;
            touch-action: none;
        }
        
        .dpad-button:active {
            background: rgba(0, 255, 255, 0.6);
            transform: scale(0.95);
        }
        
        .dpad-up {
            top: 0;
            left: 60px;
        }
        
        .dpad-down {
            bottom: 0;
            left: 60px;
        }
        
        .dpad-left {
            top: 60px;
            left: 0;
        }
        
        .dpad-right {
            top: 60px;
            right: 0;
        }
        
        .dpad-center {
            top: 60px;
            left: 60px;
            background: rgba(0, 255, 255, 0.1);
            border: 2px solid rgba(0, 255, 255, 0.3);
            pointer-events: none;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 1.5rem;
            }
            .instructions {
                font-size: 0.9rem;
            }
            .tip {
                font-size: 0.8rem;
            }
            #mobile-controls {
                display: block;
            }
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 1.2rem;
            }
            body {
                padding: 5px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        const { useState, useEffect, useRef } = React;

        function SpaceGame() {
            const gameRef = useRef(null);
            const phaserGameRef = useRef(null);

            useEffect(() => {
                if (phaserGameRef.current) return;

                // Detectar se √© mobile
                const isMobile = window.innerWidth <= 768 || 
                               ('ontouchstart' in window) || 
                               (navigator.maxTouchPoints > 0);

                // Ajustar tamanho do jogo baseado na tela
                let gameWidth = 800;
                let gameHeight = 600;
                
                if (isMobile) {
                    gameWidth = Math.min(window.innerWidth - 20, 600);
                    gameHeight = Math.min(window.innerHeight * 0.6, 450);
                }

                const config = {
                    type: Phaser.AUTO,
                    width: gameWidth,
                    height: gameHeight,
                    parent: gameRef.current,
                    backgroundColor: '#000022',
                    physics: {
                        default: 'arcade',
                        arcade: {
                            gravity: { y: 0 },
                            debug: false
                        }
                    },
                    scene: {
                        preload: preload,
                        create: create,
                        update: update
                    }
                };

                let player;
                let stars;
                let asteroids;
                let cursors;
                let score = 0;
                let scoreText;
                let gameOver = false;
                let gameOverText;
                let bg;
                
                let explorePlanets;
                let currentExplorePlanet;
                let planetNameText;
                let currentPlanetIndex = 0;
                
                // Controles m√≥veis
                let mobileControls = {
                    up: false,
                    down: false,
                    left: false,
                    right: false
                };
                
                const planetsData = [
                    { name: "Merc√∫rio", color: 0xb5b5b5, size: 35 },
                    { name: "V√™nus", color: 0xffcc66, size: 40 },
                    { name: "Terra", color: 0x3399ff, size: 42 },
                    { name: "Marte", color: 0xff5533, size: 38 },
                    { name: "J√∫piter", color: 0xffaa77, size: 55 },
                    { name: "Saturno", color: 0xffdd99, size: 52 },
                    { name: "Urano", color: 0x66ffff, size: 45 },
                    { name: "Netuno", color: 0x3366ff, size: 44 }
                ];

                function preload() {
                    this.textures.generate('player', { 
                        data: ['00300', '03330', '30003', '03330', '00300'], 
                        pixelWidth: 8 
                    });
                    
                    this.textures.generate('star', { 
                        data: ['0030000', '0030000', '3333330', '0333300', '3333330', '0030000', '0030000'], 
                        pixelWidth: 4 
                    });
                    
                    this.textures.generate('asteroid', { 
                        data: ['033330', '303033', '330303', '303330', '033300'], 
                        pixelWidth: 6 
                    });
                }

                function create() {
                    const width = this.scale.width;
                    const height = this.scale.height;

                    bg = this.add.group();
                    for (let i = 0; i < 100; i++) {
                        const x = Phaser.Math.Between(0, width);
                        const y = Phaser.Math.Between(0, height);
                        const star = this.add.circle(x, y, 1, 0xFFFFFF, 0.6);
                        bg.add(star);
                    }

                    player = this.physics.add.sprite(width / 2, height - 80, 'player');
                    player.setScale(3);
                    player.setCollideWorldBounds(true);
                    player.setTint(0x00FFFF);

                    stars = this.physics.add.group();
                    asteroids = this.physics.add.group();
                    explorePlanets = this.physics.add.group();

                    cursors = this.input.keyboard.createCursorKeys();

                    scoreText = this.add.text(16, 16, 'Pontos: 0', { 
                        fontSize: isMobile ? '24px' : '32px', 
                        fill: '#FFF',
                        fontFamily: 'Arial',
                        stroke: '#000',
                        strokeThickness: 4
                    });
                    
                    planetNameText = this.add.text(width / 2, 50, '', {
                        fontSize: isMobile ? '32px' : '48px',
                        fill: '#FFD700',
                        fontFamily: 'Arial',
                        stroke: '#000',
                        strokeThickness: 6
                    }).setOrigin(0.5).setAlpha(0);

                    this.time.addEvent({
                        delay: 1500,
                        callback: spawnStar,
                        callbackScope: this,
                        loop: true
                    });

                    this.time.addEvent({
                        delay: 2000,
                        callback: spawnAsteroid,
                        callbackScope: this,
                        loop: true
                    });

                    this.physics.add.overlap(player, stars, collectStar, null, this);
                    this.physics.add.overlap(player, asteroids, hitAsteroid, null, this);
                    this.physics.add.overlap(player, explorePlanets, discoverPlanet, null, this);
                    
                    spawnExplorePlanet.call(this);
                    
                    // Configurar controles mobile
                    if (isMobile) {
                        setupMobileControls();
                    }
                }
                
                function setupMobileControls() {
                    const buttons = ['up', 'down', 'left', 'right'];
                    
                    buttons.forEach(direction => {
                        const button = document.getElementById(`dpad-${direction}`);
                        if (!button) return;
                        
                        const startPress = () => {
                            mobileControls[direction] = true;
                        };
                        
                        const endPress = () => {
                            mobileControls[direction] = false;
                        };
                        
                        button.addEventListener('touchstart', startPress, { passive: true });
                        button.addEventListener('touchend', endPress, { passive: true });
                        button.addEventListener('touchcancel', endPress, { passive: true });
                        button.addEventListener('mousedown', startPress);
                        button.addEventListener('mouseup', endPress);
                        button.addEventListener('mouseleave', endPress);
                    });
                }

                function spawnExplorePlanet() {
                    if (gameOver) return;
                    
                    const width = this.scale.width;
                    const height = this.scale.height;
                    const planetData = planetsData[currentPlanetIndex];
                    const x = Phaser.Math.Between(100, width - 100);
                    const y = Phaser.Math.Between(100, height - 150);
                    
                    currentExplorePlanet = this.add.circle(x, y, planetData.size, planetData.color, 0.8);
                    this.physics.add.existing(currentExplorePlanet);
                    currentExplorePlanet.body.setImmovable(true);
                    currentExplorePlanet.planetName = planetData.name;
                    currentExplorePlanet.discovered = false;
                    
                    explorePlanets.add(currentExplorePlanet);
                    
                    this.tweens.add({
                        targets: currentExplorePlanet,
                        scaleX: 1.1,
                        scaleY: 1.1,
                        duration: 1500,
                        yoyo: true,
                        repeat: -1,
                        ease: 'Sine.easeInOut'
                    });
                }
                
                function discoverPlanet(player, planet) {
                    if (planet.discovered || gameOver) return;
                    
                    planet.discovered = true;
                    
                    planetNameText.setText(planet.planetName);
                    planetNameText.setAlpha(1);
                    
                    this.tweens.add({
                        targets: planetNameText,
                        scale: { from: 0.8, to: 1.2 },
                        duration: 400,
                        yoyo: true,
                        repeat: 2
                    });
                    
                    this.tweens.add({
                        targets: planet,
                        angle: 360,
                        duration: 2000,
                        ease: 'Linear'
                    });
                    
                    const glow = this.add.circle(planet.x, planet.y, planet.radius * 1.5, 0xFFFFFF, 0.3);
                    this.tweens.add({
                        targets: glow,
                        alpha: 0,
                        scale: 2,
                        duration: 1000,
                        onComplete: () => glow.destroy()
                    });
                    
                    score += 50;
                    scoreText.setText('Pontos: ' + score);
                    
                    this.time.delayedCall(3000, () => {
                        this.tweens.add({
                            targets: planetNameText,
                            alpha: 0,
                            duration: 500
                        });
                        
                        planet.destroy();
                        currentPlanetIndex = (currentPlanetIndex + 1) % planetsData.length;
                        spawnExplorePlanet.call(this);
                    });
                }

                function spawnStar() {
                    if (gameOver) return;
                    
                    const width = this.scale.width;
                    const x = Phaser.Math.Between(50, width - 50);
                    const star = stars.create(x, 0, 'star');
                    star.setScale(3);
                    star.setVelocityY(150);
                    star.setTint(0xFFFF00);
                }

                function spawnAsteroid() {
                    if (gameOver) return;
                    
                    const width = this.scale.width;
                    const x = Phaser.Math.Between(50, width - 50);
                    const asteroid = asteroids.create(x, 0, 'asteroid');
                    asteroid.setScale(2);
                    asteroid.setVelocityY(200);
                    asteroid.setTint(0x888888);
                    asteroid.setAngularVelocity(100);
                }

                function collectStar(player, star) {
                    star.destroy();
                    score += 10;
                    scoreText.setText('Pontos: ' + score);
                    
                    const flash = this.add.circle(star.x, star.y, 20, 0xFFFF00, 0.8);
                    this.tweens.add({
                        targets: flash,
                        alpha: 0,
                        scale: 2,
                        duration: 300,
                        onComplete: () => flash.destroy()
                    });
                }

                function hitAsteroid(player, asteroid) {
                    if (gameOver) return;
                    
                    // gameOver = true;
                    
                    // this.physics.pause();
                    player.setTint(0xFF0000);
                    
                    for (let i = 0; i < 8; i++) {
                        const particle = this.add.circle(player.x, player.y, 5, 0xFF6600);
                        const angle = (i / 8) * Math.PI * 2;
                        this.tweens.add({
                            targets: particle,
                            x: player.x + Math.cos(angle) * 100,
                            y: player.y + Math.sin(angle) * 100,
                            alpha: 0,
                            duration: 500,
                            onComplete: () => particle.destroy()
                        });
                    }

                    const width = this.scale.width;
                    const height = this.scale.height;

                    // gameOverText = this.add.text(width / 2, height / 2 - 50, 'GAME OVER!', {
                    //     fontSize: isMobile ? '48px' : '64px',
                    //     fill: '#FF0000',
                    //     fontFamily: 'Arial',
                    //     stroke: '#FFF',
                    //     strokeThickness: 6
                    // });
                    // gameOverText.setOrigin(0.5);

                    // const finalScoreText = this.add.text(width / 2, height / 2 + 20, 'Pontua√ß√£o Final: ' + score, {
                    //     fontSize: isMobile ? '24px' : '32px',
                    //     fill: '#FFF',
                    //     fontFamily: 'Arial',
                    //     stroke: '#000',
                    //     strokeThickness: 4
                    // });
                    // finalScoreText.setOrigin(0.5);

                    // const restartText = this.add.text(width / 2, height / 2 + 80, isMobile ? 'Toque para recome√ßar' : 'Pressione ESPA√áO para jogar novamente', {
                    //     fontSize: isMobile ? '18px' : '24px',
                    //     fill: '#FFFF00',
                    //     fontFamily: 'Arial',
                    //     stroke: '#000',
                    //     strokeThickness: 3
                    // });
                    // restartText.setOrigin(0.5);

                    // const restartGame = () => {
                    //     this.scene.restart();
                    //     score = 0;
                    //     gameOver = false;
                    //     currentPlanetIndex = 0;
                    // };

                    // this.input.keyboard.once('keydown-SPACE', restartGame);
                    // this.input.once('pointerdown', restartGame);
                }

                function update() {
                    if (gameOver) return;

                    const speed = 300;
                    player.setVelocity(0);

                    // Controles de teclado
                    if (cursors.left.isDown || mobileControls.left) {
                        player.setVelocityX(-speed);
                    } else if (cursors.right.isDown || mobileControls.right) {
                        player.setVelocityX(speed);
                    }

                    if (cursors.up.isDown || mobileControls.up) {
                        player.setVelocityY(-speed);
                    } else if (cursors.down.isDown || mobileControls.down) {
                        player.setVelocityY(speed);
                    }

                    const height = this.scale.height;

                    stars.children.entries.forEach(star => {
                        if (star.y > height + 50) {
                            star.destroy();
                        }
                    });

                    asteroids.children.entries.forEach(asteroid => {
                        if (asteroid.y > height + 50) {
                            asteroid.destroy();
                        }
                    });

                    bg.children.entries.forEach((star) => {
                        star.y += 0.5;
                        if (star.y > height) {
                            star.y = 0;
                        }
                    });
                }

                phaserGameRef.current = new Phaser.Game(config);

                return () => {
                    if (phaserGameRef.current) {
                        phaserGameRef.current.destroy(true);
                        phaserGameRef.current = null;
                    }
                };
            }, []);

            return React.createElement('div', { className: 'container' },
                React.createElement('h1', null, 'üöÄ Aventura Espacial do Raffiq üåü'),
                React.createElement('p', { className: 'instructions' }, 
                    'Use as setas ‚Üê ‚Üí ‚Üë ‚Üì para mover a nave'),
                React.createElement('p', { className: 'tip' }, 
                    'Colete estrelas ‚≠ê, descubra planetas ü™ê e desvie dos asteroides! üí•'),
                React.createElement('div', { ref: gameRef, id: 'game-container' }),
                React.createElement('div', { id: 'mobile-controls' },
                    React.createElement('div', { className: 'dpad-container' },
                        React.createElement('div', { id: 'dpad-up', className: 'dpad-button dpad-up' }, '‚ñ≤'),
                        React.createElement('div', { id: 'dpad-down', className: 'dpad-button dpad-down' }, '‚ñº'),
                        React.createElement('div', { id: 'dpad-left', className: 'dpad-button dpad-left' }, '‚óÄ'),
                        React.createElement('div', { id: 'dpad-right', className: 'dpad-button dpad-right' }, '‚ñ∂'),
                        React.createElement('div', { className: 'dpad-button dpad-center' }, '‚ú¶')
                    )
                )
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(SpaceGame));
    </script>
</body>
</html>